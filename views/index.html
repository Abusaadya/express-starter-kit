{% extends 'layout.html' %}
{% block content %}
{% if not isLogin %}
{# This case is handled by auto-redirect in app.js, but kept as fallback #}
<div style="text-align: center; padding: 40px;">
  <h2>ูุฑุฌู ุชุณุฌูู ุงูุฏุฎูู ุฅูู ุญุณุงุจ ุณูุฉ ุงูุฎุงุต ุจู</h2>
  <a href="/login"
    style="display: inline-block; background: #69d5c4; color: #fff; padding: 10px 20px; border-radius: 5px; text-decoration: none; font-weight: bold;">ุชุณุฌูู
    ุงูุฏุฎูู ุจุงุณุชุฎุฏุงู ุณูุฉ</a>
</div>
{% else %}

<div style="margin-bottom: 30px; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 20px;">
  <h2 style="margin: 0; color: #69d5c4;">ุฃููุงู ุจู ุ <span style="font-weight: bold">{{ name }}</span> ๐</h2>
  <p style="opacity: 0.8; margin-top: 10px;">ุฅููู ููุฎุต ููุชุงุฌุฑู ุงููุฑุชุจุทุฉ ูุญุงูุงุช ุงูุชูุจูู ุงูุฎุงุตุฉ ุจูุง.</p>
</div>

{# Dashboard Statistics Summary #}
<div
  style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 40px;">
  <div
    style="background: rgba(105, 213, 196, 0.1); padding: 20px; border-radius: 12px; border: 1px solid rgba(105, 213, 196, 0.2); text-align: center;">
    <div style="font-size: 24px; font-weight: bold; color: #69d5c4;">{{ stores.length }}</div>
    <div style="font-size: 14px; opacity: 0.8;">ูุชุงุฌุฑ ูุชุตูุฉ</div>
  </div>
  {% set total_telegram = 0 %}
  {% for store in stores %}
  {% set total_telegram = total_telegram + store.StoreTelegrams.length %}
  {% endfor %}
  <div
    style="background: rgba(52, 152, 219, 0.1); padding: 20px; border-radius: 12px; border: 1px solid rgba(52, 152, 219, 0.2); text-align: center;">
    <div style="font-size: 24px; font-weight: bold; color: #3498db;">{{ total_telegram }}</div>
    <div style="font-size: 14px; opacity: 0.8;">ุญุณุงุจุงุช ุชููุฌุฑุงู ูุฑุจูุทุฉ</div>
  </div>
</div>

<h3 style="margin-bottom: 20px; font-size: 18px; border-right: 4px solid #69d5c4; padding-right: 15px;">ูุงุฆูุฉ ุงููุชุงุฌุฑ
  ูุงูุชูุจููุงุช ๐ฆ</h3>

<div style="display: grid; gap: 20px;">
  {% for store in stores %}
  <div
    style="background: rgba(255,255,255,0.05); border-radius: 15px; border: 1px solid rgba(255,255,255,0.1); overflow: hidden;">
    <div
      style="display: flex; align-items: center; gap: 20px; padding: 20px; background: rgba(255,255,255,0.03); border-bottom: 1px solid rgba(255,255,255,0.1);">
      <img src="{{store.store_avatar or 'https://salla.sa/favicon.ico'}}" width="60" height="60"
        style="border-radius: 12px; border: 2px solid #69d5c4; background: #fff;" />
      <div style="flex-grow: 1;">
        <h4 style="margin: 0; font-size: 18px; color: #fff;">{{ store.store_name }}</h4>
        <p style="margin: 5px 0 0 0; font-size: 12px; opacity: 0.6;">ูุนุฑู ุงูุชุงุฌุฑ: {{ store.merchant }}</p>
      </div>
      <div style="text-align: left;">
        <a href="/orders?merchant_id={{store.merchant}}"
          style="font-size: 12px; color: #69d5c4; text-decoration: none; border: 1px solid #69d5c4; padding: 5px 12px; border-radius: 20px;">ุนุฑุถ
          ุงูุทูุจุงุช โ</a>
      </div>
    </div>

    <div style="padding: 20px;">
      <div style="font-size: 14px; font-weight: bold; margin-bottom: 12px; color: #69d5c4;">
        <i style="color: #69d5c4;">โ๏ธ</i> ุญุณุงุจุงุช ุชููุฌุฑุงู ุงููุฑุชุจุทุฉ ุจูุฐุง ุงููุชุฌุฑ:
      </div>

      {% if store.StoreTelegrams and store.StoreTelegrams.length > 0 %}
      <div style="display: flex; flex-wrap: wrap; gap: 10px;">
        {% for tg in store.StoreTelegrams %}
        <div
          style="background: rgba(52, 152, 219, 0.15); color: #3498db; padding: 8px 15px; border-radius: 8px; font-size: 13px; display: flex; align-items: center; gap: 8px; border: 1px solid rgba(52, 152, 219, 0.3);">
          <span style="font-weight: bold;">๐ค {{ tg.name }}</span>
          <span style="opacity: 0.7; font-size: 11px;">(ID: {{ tg.chat_id }})</span>
        </div>
        {% endfor %}
      </div>
      {% else %}
      <div
        style="background: rgba(255, 193, 7, 0.05); color: #ffc107; padding: 15px; border-radius: 8px; border: 1px dashed rgba(255, 193, 7, 0.3); font-size: 13px;">
        โ๏ธ ูุง ุชูุฌุฏ ุญุณุงุจุงุช ุชูุฌุฑุงู ูุฑุชุจุทุฉ ุญุงููุงู. ููููู ุงูุฑุจุท ูู ุตูุญุฉ <a href="/account"
          style="color: #ffc107; font-weight: bold;">ุงูุฅุนุฏุงุฏุงุช</a>.
      </div>
      {% endif %}
    </div>
  </div>
  {% endfor %}
</div>

{% endif %}
{% endblock %}